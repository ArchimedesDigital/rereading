name: CI

on:
    push:
        branches:
        - master
    pull_request:
        branches:
        - '*'

jobs:
  ############################################################################## 
  # Python jobs
  ############################################################################## 
  python_linters:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-python@v1
      with:
        python-version: '3.7'
        architecture: 'x64'
    - name: Install Python packages
      run: |
        pip install -r requirements.txt
        pip install pylint
    - name: Run pylint on backend/
      run: pylint backend/
    - name: Run pylint on analysis/
      run: pylint analysis/


  backend_tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-python@v1
      with:
        python-version: '3.7'
        architecture: 'x64'
    - name: Install Python packages
      run: |
        pip install -r requirements.txt
    - name: Run Django tests
      run: |
        cd backend
        python manage.py test

  analysis_tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-python@v1
      with:
        python-version: '3.7'
        architecture: 'x64'
    - name: Install Python packages
      run: |
        pip install -r requirements.txt
    - name: Run analysis tests
      run: |
        cd analysis
        python analysis.py

  ############################################################################## 
  # JS jobs
  ############################################################################## 

# NOTE(ra) 2019-09-18: temporarily disabled until weird integration bug between
#                      eslint and PyCharm is resolved (ASAP!)

#  js_linters:
#    runs-on: ubuntu-latest
#    steps:
#    - uses: actions/checkout@v1
#    - uses: actions/setup-node@v1
#      with:
#        node-version: '10.x'
#    - name: Install deps and eslint
#      run: |
#        cd frontend
#        npm install
#        npm install -g eslint
#    - name: Run eslint on frontend/src
#      run: |
#        cd frontend
#        eslint src

#  frontend_tests:
#    runs-on: ubuntu-latest
#    steps:
#    - uses: actions/checkout@v1
#    - uses: actions/setup-node@v1
#      with:
#        node-version: '10.x'
#    - name: Run eslint on frontend/src
#      run: |
#        cd frontend
#        npm install
#        npm install -g eslint
#        eslint src
#
